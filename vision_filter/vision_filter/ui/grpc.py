import structlog
from google.protobuf.empty_pb2 import Empty

from vision_filter.proto import filter_visualizer_pb2_grpc
# generated by protoc
from vision_filter.proto.ssl.field.geometry_pb2 import GeometryFieldSize

from .visualizer import Visualizer


class FilterVisualizer(filter_visualizer_pb2_grpc.FilterVisualizerServicer):
    def __init__(self, visualizer: Visualizer):
        self._log = structlog.get_logger()
        self._visualizer = visualizer

    def SetFieldGeometry(self, request: GeometryFieldSize, context) -> Empty:
        self._log.debug("SetFieldGeometry called", request=request, context=context)
        self._visualizer.set_field_geometry(request)
        return Empty()

    def GetFieldGeometry(self, request: Empty, context) -> GeometryFieldSize:
        self._log.debug("GetFieldGeometry called", request=request, context=context)
        return self._visualizer.get_field_geometry()
